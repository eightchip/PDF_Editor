# PDF注釈アプリ

PDF教材を読み込み、各ページにタッチペンで手書き注釈できるWebアプリケーション（MVP）です。

## 機能

- PDFファイルの読み込みと表示
- ページごとの手書き注釈（ペン/消しゴム）
- 注釈の永続化（IndexedDB使用）
- ページ移動
- ズーム機能（75% / 100% / 125%）
- Undo/Redo機能
- ページ単位のClear機能

## 技術スタック

- **フレームワーク**: Next.js 16 (App Router)
- **言語**: TypeScript
- **PDF表示**: pdfjs-dist
- **データ永続化**: IndexedDB (idb)

## 起動手順

### 1. 依存関係のインストール

```bash
npm install
```

### 2. 開発サーバーの起動

```bash
npm run dev
```

### 3. ブラウザでアクセス

[http://localhost:3000](http://localhost:3000) を開いてください。

## 使い方

### PDFファイルの読み込み

1. 画面上部の「ファイル選択」ボタンをクリック
2. PDFファイルを選択
3. 1ページ目が自動的に表示されます

### 注釈の追加

1. **ペンツール**を選択
2. 色と太さを設定（必要に応じて）
3. PDF上でマウスをドラッグして描画
4. タッチペンや指でも描画可能です

### 消しゴムツール

1. **消しゴム**を選択
2. 消しゴムサイズを設定
3. 消したい部分をドラッグ

### ページ移動

- **前へ** / **次へ** ボタンでページを移動
- ページごとに注釈が独立して保存されます

### ズーム

- **75%** / **100%** / **125%** ボタンでズーム変更
- ズーム変更後も注釈の位置は正しく表示されます

### Undo/Redo

- **Undo**: 直前の操作を取り消し
- **Redo**: 取り消した操作を元に戻す

### Clear

- **Clear** ボタンで現在のページの全注釈を削除

### 注釈の保存

- 注釈は自動的にIndexedDBに保存されます
- ブラウザをリロードしても注釈は復元されます
- 同じPDFファイルを再度読み込むと、以前の注釈が表示されます

## プロジェクト構造

```
pdf_annotator_web/
├── app/
│   ├── lib/
│   │   ├── id.ts      # docId生成
│   │   ├── db.ts      # IndexedDB操作
│   │   ├── pdf.ts     # PDF.js操作
│   │   └── ink.ts     # ストローク描画
│   └── page.tsx        # メインUI
├── package.json
└── README.md
```

## 注意事項

- このアプリはローカル完結型です（認証/サーバー保存なし）
- 注釈はブラウザのIndexedDBに保存されます
- ブラウザのデータを削除すると注釈も削除されます
- PDFファイルは読み込まれた時点でメモリに保持されます（サーバーには送信されません）

## デプロイ（Vercel）

### パスワード保護機能の設定

パスワード保護機能を使用するには、Vercelのビルド環境で`qpdf`が利用可能である必要があります。

#### 方法1: 環境変数でqpdfのパスを指定

1. Vercelのプロジェクト設定に移動
2. 「Environment Variables」セクションで以下を追加：
   - 変数名: `QPDF_PATH`
   - 値: `/usr/bin/qpdf` または `qpdf`（PATHに含まれている場合）

#### 方法2: Vercelのビルドコマンドでqpdfをインストール

Vercelのビルド環境では`sudo`権限がないため、`qpdf`を直接インストールすることは困難です。
代わりに、Vercelのカスタムビルドイメージを使用するか、環境変数で`qpdf`のパスを指定してください。

#### トラブルシューティング

- デプロイ後にパスワード保護機能が動作しない場合：
  1. Vercelのログを確認して、`qpdf`が見つからないエラーがないか確認
  2. 環境変数`QPDF_PATH`が正しく設定されているか確認
  3. Vercelのビルドログで`qpdf`の検出状況を確認

## 開発

### ビルド

```bash
npm run build
```

### 本番環境での起動

```bash
npm start
```

## ライセンス

このプロジェクトは個人利用・学習目的で作成されています。
